{"ast":null,"code":"import _classCallCheck from \"D:/proyectos_Morton/Mi-Morton-Angular/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"D:/proyectos_Morton/Mi-Morton-Angular/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { HttpClient } from '@angular/common/http';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport var AuthService = /*#__PURE__*/(function () {\n  var AuthService = /*#__PURE__*/function () {\n    //CREAR USUARIO\n    //LOGIN USUARIO\n    function AuthService(http) {\n      _classCallCheck(this, AuthService);\n\n      this.http = http; //private url = 'https://masanchez.com.mx/ARGENTINA/PHP1/';\n\n      this.url = 'http://localhost/PHP/';\n      this.read_token();\n    }\n    /**********************************\r\n    * ACCESO\r\n    **********************************/\n\n\n    _createClass(AuthService, [{\n      key: \"logout\",\n      value: function logout() {\n        localStorage.removeItem('token');\n      }\n    }, {\n      key: \"login\",\n      value: function login(usuario) {\n        var _this = this;\n\n        var authdata = {\n          email: usuario.email,\n          password: usuario.password\n        };\n        console.log(\"service\" + authdata);\n        console.log(\"E\" + authdata.email);\n        console.log(\"C\" + authdata.password); //return this.http.get(`${this.url}?busca_usuario=1&email=` + authdata.email);\n\n        return this.http.get(this.url + '?busca_usuario=1&email=' + authdata.email + '&contra=' + authdata.password + '').pipe(map(function (resp) {\n          console.log(\"Entro en map()\");\n\n          _this.saveToken(resp['id_token']);\n\n          return resp;\n        }));\n      }\n    }, {\n      key: \"nuevo_usuario\",\n      value: function nuevo_usuario(usuario) {\n        var _this2 = this;\n\n        var authdata = {\n          email: usuario.email,\n          password: usuario.password\n        }; //return this.http.post(`${this.url}`, authdata);            //WITHOUT TOKEN\n        //map =read the answer of http\n\n        return this.http.post(\"\".concat(this.url), authdata).pipe(map(function (resp) {\n          console.log(\"Entro en: map()\");\n          console.log(resp);\n          console.log(\"---------------\"); //this.saveToken(resp['idToken']);\n\n          _this2.saveToken(resp['id_token']);\n\n          return resp;\n        }));\n      }\n    }, {\n      key: \"saveToken\",\n      value: function saveToken(idToken) {\n        console.log(\"saveToken\");\n        console.log(idToken);\n        this.userToken = idToken;\n        localStorage.setItem('token', idToken);\n        var hoy = new Date();\n        hoy.setSeconds(3600);\n        localStorage.setItem('expira', hoy.getTime().toString());\n      }\n    }, {\n      key: \"read_token\",\n      value: function read_token() {\n        if (localStorage.getItem('token')) {\n          this.userToken = localStorage.getItem('token');\n        } else {\n          this.userToken = '';\n        }\n\n        return this.userToken;\n      }\n    }, {\n      key: \"its_authenticate\",\n      value: function its_authenticate() {\n        if (this.userToken.length < 2) {\n          return false;\n        }\n\n        var expira = Number(localStorage.getItem('expira'));\n        var expiraDate = new Date();\n        expiraDate.setTime(expira);\n\n        if (expiraDate > new Date()) {\n          return true;\n        } else {\n          return false;\n        } //return this.userToken.length > 2;\n\n      }\n      /**********************************\r\n      * SERVICIOS NODEJS\r\n      **********************************/\n\n    }, {\n      key: \"getContratosToRFC\",\n      value: function getContratosToRFC(custno) {\n        return this.http.get('https://mimorton.com:8444/getContratosMiMorton/' + custno + '').pipe(map(function (res) {\n          return res;\n        }));\n      }\n    }, {\n      key: \"getComprasToRFC\",\n      value: function getComprasToRFC(custno) {\n        return this.http.get('https://mimorton.com:8444/getComprasMiMorton/' + custno + '').pipe(map(function (res) {\n          return res;\n        }));\n      }\n    }, {\n      key: \"getVentasToRFC\",\n      value: function getVentasToRFC(custno) {\n        return this.http.get('https://mimorton.com:8444/getVentasMiMorton/' + custno + '');\n        /*\r\n        .pipe(\r\n          map ( (res:any ) => {\r\n            return res;\r\n          }),\r\n          catchError ( (err) => this.handlerError(err))\r\n        );\r\n        */\n      }\n    }, {\n      key: \"getDetailImg\",\n      value: function getDetailImg(busqueda) {\n        return this.http.get('https://mimorton.com:8444/getDetailMiMorton/' + busqueda + '').pipe(map(function (auctionfindDB) {\n          return auctionfindDB;\n        })); //return this.http.get('https://mimorton.com:8443/estadoCuenta?oper=getDetail&id=' + busqueda + '');\n      }\n    }, {\n      key: \"getDetailSaleImg\",\n      value: function getDetailSaleImg(subasta, busqueda) {\n        return this.http.get('https://mimorton.com:8444/getDetailSaleMiMorton/' + subasta + '/' + busqueda + '').pipe(map(function (auctionfindDB) {\n          return auctionfindDB;\n        })); //return this.http.get('https://mimorton.com:8443/estadoCuenta?oper=getDetailSale&subasta='+ subasta +'&id=' + busqueda + '');\n      }\n    }]);\n\n    return AuthService;\n  }();\n\n  AuthService.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  AuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module"}